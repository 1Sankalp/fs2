(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{1228:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),a=r(2115),l=r(5695),o=r(2108),i=r(351);let n=e=>{if(!e||0===e.length)return"";if(1===e.length)return e[0];let t=[...e].sort((e,t)=>e.length-t.length),r=t[0];if(t.every(e=>e.endsWith(r)))return r;let s=e.map(e=>{let t=e.indexOf("@");return t>=0?e.substring(t):e}).reduce((e,t)=>{if(!e)return t;let r=1;for(;r<=Math.min(e.length,t.length)&&e.slice(-r)===t.slice(-r);)r++;return e.slice(-r+1)},"");e.map(e=>{let t=e.indexOf("@");return t>=0?e.substring(0,t):""});let a=[...e].sort((e,t)=>{let r=e.split("@")[0]||"",s=t.split("@")[0]||"";return r.length-s.length});for(let e of a){let[t,r]=e.split("@");if(r&&r.endsWith(s.slice(1))&&a.every(r=>r===e||r.includes(t+"@")))return e}return r},c=e=>{if(!e||0===e.length)return[];let t={};e.forEach(e=>{e.email&&(t[e.website]||(t[e.website]=[]),t[e.website].push(e.email))});let r=[];return e.forEach(e=>{if(r.some(t=>t.website===e.website))return;let s=t[e.website];if(s&&0!==s.length){if(1===s.length)r.push({website:e.website,email:s[0]});else{let t=n(s);r.push({website:e.website,email:t})}}else r.push(e)}),r};function d(e){let{params:t}=e,[r,n]=(0,a.useState)(null),{data:d,status:m}=(0,o.useSession)(),x=(0,l.useRouter)(),[u,h]=(0,a.useState)(!0),[p,b]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),[j,y]=(0,a.useState)([]),[v,w]=(0,a.useState)([]),[N,O]=(0,a.useState)(null),[E,k]=(0,a.useState)(!1),[C,S]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let e=await t;n(e.id)}catch(e){console.error("Error resolving params:",e),b("Invalid job ID"),h(!1)}})()},[t]),(0,a.useEffect)(()=>{"unauthenticated"===m&&x.push("/auth/signin")},[m,x]),(0,a.useEffect)(()=>{(async function(){if(r){h(!0),b("");try{var e,t;console.log("Fetching job data for ID: ".concat(r));let s=await fetch("/api/jobs/".concat(r));if(!s.ok){let e=await s.text();throw console.error("Error response from API: ".concat(e)),Error("Failed to load job: ".concat(s.status," ").concat(s.statusText))}let a=await s.json();if(console.log("Job data received:",a),!a.job)throw Error("Invalid job data received");let l={...a.job,totalUrls:a.job.totalUrls||a.job.totalWebsites||0,processedUrls:a.job.processedUrls||a.job.processedWebsites||0,progress:a.job.progress||0};if(f(l),a.job.results?y(a.job.results):a.results?y(a.results):(console.warn("No results found in API response"),y([])),console.log("Job data loaded:",l),console.log("Results loaded:",(null===(e=a.results)||void 0===e?void 0:e.length)||(null===(t=a.job.results)||void 0===t?void 0:t.length)||0),"processing"===l.status||"pending"===l.status){h(!1);let e=setInterval(async()=>{try{let t=await fetch("/api/jobs/".concat(r));if(!t.ok)throw Error("Failed to refresh job data");let s=await t.json();if(s.job){let t={...s.job,totalUrls:s.job.totalUrls||s.job.totalWebsites||0,processedUrls:s.job.processedUrls||s.job.processedWebsites||0,progress:s.job.progress||0};f(t),s.job.results?y(s.job.results):s.results&&y(s.results),"processing"!==t.status&&"pending"!==t.status&&clearInterval(e)}}catch(e){console.error("Error polling job data:",e)}},3e3);return()=>clearInterval(e)}h(!1)}catch(e){console.error("Error loading job data:",e),b(e instanceof Error?e.message:"Failed to load job"),h(!1)}}})()},[r]),(0,a.useEffect)(()=>{j.length>0?w(c(j)):w([])},[j]);let P=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{O(t),setTimeout(()=>O(null),2e3)})},z=C?v.filter(e=>{var t,r;return(null===(t=e.website)||void 0===t?void 0:t.toLowerCase().includes(C.toLowerCase()))||(null===(r=e.email)||void 0===r?void 0:r.toLowerCase().includes(C.toLowerCase()))}):v;return"loading"===m||u?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600 font-medium",children:"Loading job results..."})]})}):p?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-8",children:(0,s.jsxs)("div",{className:"bg-red-50 p-6 rounded-xl shadow-sm border border-red-100 max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center text-red-700 mb-2",children:[(0,s.jsx)(i.y3G,{className:"mr-2",size:20}),(0,s.jsx)("h3",{className:"font-semibold",children:"Error Loading Results"})]}),(0,s.jsx)("p",{className:"text-red-600 mb-4",children:p}),(0,s.jsxs)("button",{onClick:()=>x.push("/dashboard"),className:"px-4 py-2 bg-white text-primary hover:bg-gray-50 border border-primary/20 rounded-lg transition-colors flex items-center text-sm font-medium shadow-sm",children:[(0,s.jsx)(i.kRp,{className:"mr-2"})," Back to Dashboard"]})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-100",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i.pHD,{className:"text-primary text-xl mr-2"}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Email Scraper"})]}),(0,s.jsxs)("button",{onClick:()=>x.push("/dashboard?tab=jobs"),className:"text-gray-600 hover:text-primary transition-colors flex items-center font-medium",children:[(0,s.jsx)(i.kRp,{className:"mr-2"})," Back to Jobs"]})]})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-8 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"px-4 py-4 sm:px-0",children:[g&&(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-xl p-6 mb-6 border border-gray-100",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,s.jsx)(i.QPV,{className:"mr-2 text-primary"}),"Job Details"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[(0,s.jsxs)("h3",{className:"text-xs font-medium text-gray-500 uppercase flex items-center",children:[(0,s.jsx)(i.HaR,{className:"mr-1.5 text-gray-400",size:14}),"Google Sheet"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900 break-all font-medium",children:g.sheetUrl})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[(0,s.jsxs)("h3",{className:"text-xs font-medium text-gray-500 uppercase flex items-center",children:[(0,s.jsx)(i.QPV,{className:"mr-1.5 text-gray-400",size:14}),"Column Used"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:g.columnName})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[(0,s.jsxs)("h3",{className:"text-xs font-medium text-gray-500 uppercase flex items-center",children:[(0,s.jsx)(i.wIk,{className:"mr-1.5 text-gray-400",size:14}),"Created"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-900 font-medium",children:new Date(g.createdAt).toLocaleString()})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,s.jsx)(i.A3x,{className:"text-green-500 mr-2"}),(0,s.jsxs)("span",{children:["Found ",(0,s.jsx)("span",{className:"font-bold text-gray-700",children:v.length})," emails from ",(0,s.jsx)("span",{className:"font-bold text-gray-700",children:g.totalUrls||0})," websites"]})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("button",{onClick:()=>{if(0===v.length)return;let e=v.map(e=>"".concat(e.website||"","	").concat(e.email||"")).join("\n");navigator.clipboard.writeText(e).then(()=>{k(!0),setTimeout(()=>k(!1),2e3)})},className:"flex items-center px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 transition-colors font-medium text-sm border border-gray-200",children:[(0,s.jsx)(i.ydS,{className:"mr-2"}),E?"Copied!":"Copy All"]}),(0,s.jsxs)("a",{href:"/api/jobs/".concat(g.id,"/download"),className:"flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium text-sm shadow-sm",download:"emails-".concat(g.id,".csv"),children:[(0,s.jsx)(i.a4x,{className:"mr-2"})," Download CSV"]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-100",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(i.pHD,{className:"text-primary mr-2"}),"Email Results",(0,s.jsxs)("span",{className:"ml-2 bg-primary-50 text-primary-700 text-xs font-medium px-2.5 py-0.5 rounded",children:[z.length," emails found"]})]}),(0,s.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(i.CKj,{className:"text-gray-400",size:16})}),(0,s.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"Search website or email...",value:C,onChange:e=>S(e.target.value)})]})]}),0===z.length?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400 mb-2",children:(0,s.jsx)(i.pHD,{size:40,className:"mx-auto"})}),(0,s.jsxs)("p",{className:"text-gray-700 font-medium",children:["No emails found",C?" matching your search":" for this job","."]}),C&&(0,s.jsx)("button",{onClick:()=>S(""),className:"mt-2 text-primary hover:underline text-sm",children:"Clear search"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)("div",{className:"h-[400px] overflow-y-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 compact-table",children:[(0,s.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Website"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"Copy"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-6 py-3 whitespace-nowrap text-sm text-gray-500 truncate max-w-xs",children:(0,s.jsxs)("a",{href:e.website.startsWith("http")?e.website:"http://".concat(e.website),target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary hover:underline transition-colors flex items-center",children:[e.website,(0,s.jsx)(i.HaR,{className:"ml-1.5",size:12})]})}),(0,s.jsx)("td",{className:"px-6 py-3 whitespace-nowrap text-sm text-gray-900 truncate max-w-xs font-medium",children:e.email||(0,s.jsx)("span",{className:"text-gray-400 italic",children:"No email found"})}),(0,s.jsx)("td",{className:"px-6 py-3 whitespace-nowrap text-sm text-gray-500",children:e.email&&(0,s.jsx)("button",{onClick:()=>P(e.email,t),className:"p-1.5 rounded-md text-gray-600 hover:text-primary hover:bg-gray-100 transition-colors",title:"Copy email",children:N===t?(0,s.jsx)(i.A3x,{className:"text-green-500",size:16}):(0,s.jsx)(i.nxz,{size:16})})})]},t))})]})})})]}),(0,s.jsx)("div",{className:"text-center text-sm text-gray-500 mt-6",children:(0,s.jsxs)("p",{children:["Need help? Check our ",(0,s.jsx)("a",{href:"#",className:"text-primary hover:underline",children:"documentation"})," or ",(0,s.jsx)("a",{href:"#",className:"text-primary hover:underline",children:"contact support"}),"."]})})]})})]})}},3148:(e,t,r)=>{Promise.resolve().then(r.bind(r,1228))},4436:(e,t,r)=>{"use strict";r.d(t,{k5:()=>d});var s=r(2115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=s.createContext&&s.createContext(a),o=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){var s,a,l;s=e,a=t,l=r[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(a))in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e){return t=>s.createElement(m,i({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,r)=>s.createElement(t.tag,c({key:r},t.attr),e(t.child)))}(e.child))}function m(e){var t=t=>{var r,{attr:a,size:l,title:n}=e,d=function(e,t){if(null==e)return{};var r,s,a=function(e,t){if(null==e)return{};var r={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;r[s]=e[s]}return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)r=l[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,o),m=l||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),s.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,d,{className:r,style:c(c({color:e.color||t.color},t.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),n&&s.createElement("title",null,n),e.children)};return void 0!==l?s.createElement(l.Consumer,null,e=>t(e)):t(a)}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[844,108,441,684,358],()=>t(3148)),_N_E=e.O()}]);