(()=>{var e={};e.id=796,e.ids=[796],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},7354:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>m,routeModule:()=>f,serverHooks:()=>j,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{DELETE:()=>b,GET:()=>p});var o=s(96559),n=s(48088),i=s(37719),a=s(32190),u=s(19854),l=s(12909),c=s(31183),d=s(11323);async function p(e){let r=null;try{let s=new URL(e.url).pathname.split("/").pop();if(!s)return a.NextResponse.json({error:"Job ID is required"},{status:400});console.log(`Getting job details for job ID: ${s}`);let t=await (0,u.getServerSession)(l.Nh);if(!t)return console.log("No session found - user not authenticated"),a.NextResponse.json({error:"Unauthorized"},{status:401});let o=t.user.id;if(console.log(`User ID from session: ${o}`),o.startsWith("hardcoded-")){if(console.log(`User is hardcoded, checking memory store for job ${s}`),d.hardcodedJobs.has(s)){console.log(`Found job ${s} in memory store`);let e=d.hardcodedJobs.get(s);if(e&&e.userId!==o)return console.log(`Job ${s} belongs to ${e.userId}, not current user ${o}`),a.NextResponse.json({error:"Unauthorized"},{status:403});if(e){let r=e.totalWebsites||0,s=e.processedWebsites||0,t=r>0?Math.min(100,Math.floor(s/r*100)):0;return a.NextResponse.json({job:{id:e.id,name:e.name,status:e.status,sheetUrl:e.sheetUrl,columnName:e.columnName,createdAt:e.createdAt,updatedAt:e.updatedAt,progress:t,totalUrls:r,processedUrls:s,userId:e.userId},results:e.results||[]})}}else console.log(`Job ${s} not found in memory store for user ${o}`)}console.log(`Fetching job ${s} from database for user ${o}`);try{r=(0,c.b)();let e=await r.job.findUnique({where:{id:s}});if(!e)return console.log(`Job ${s} not found in database`),a.NextResponse.json({error:"Job not found"},{status:404});if(e.userId!==o)return console.log(`Job ${s} belongs to ${e.userId}, not current user ${o}`),a.NextResponse.json({error:"Unauthorized"},{status:403});console.log(`Successfully found job ${s} for user ${o} in database, fetching results...`);let t=await r.result.findMany({where:{jobId:s},orderBy:{createdAt:"asc"}});console.log(`Found ${t.length} results for job ${s}`);let n=e.totalUrls||0,i=t.length,u=n>0?Math.min(100,Math.floor(i/n*100)):0;return a.NextResponse.json({job:{...e,progress:u,totalUrls:n,processedUrls:i},results:t.map(e=>({website:e.website,email:e.email}))})}catch(e){return console.error(`Database error fetching job ${s}:`,e),a.NextResponse.json({error:"Database error fetching job"},{status:500})}finally{r&&await r.$disconnect()}}catch(e){return console.error("Get job error:",e),a.NextResponse.json({error:"Failed to get job"},{status:500})}}async function b(e){let r=null;try{let t=new URL(e.url).pathname.split("/").pop();if(!t)return console.error("DELETE request missing job ID"),a.NextResponse.json({error:"Job ID is required"},{status:400});console.log(`DELETE request for job ID: ${t}`);let o=await (0,u.getServerSession)(l.Nh);if(!o)return console.log("DELETE request - No session found"),a.NextResponse.json({error:"Unauthorized"},{status:401});let n=o.user.id;console.log(`DELETE request - User ID: ${n}`);try{let{deleteJob:e}=await Promise.resolve().then(s.bind(s,11323));r=(0,c.b)();let o=!1,i=!1;try{let e=await r.job.findUnique({where:{id:t},select:{id:!0,userId:!0}});e?(o=!0,i=e.userId===n,console.log(`Job ${t} found in database, belongs to user: ${i}`)):console.log(`Job ${t} not found in database`)}catch(e){console.error(`Error checking job ${t} in database:`,e)}if(!o||!i){let{hardcodedJobs:e}=await Promise.resolve().then(s.bind(s,11323));if(e.has(t)){let r=e.get(t);o=!0,i=r?.userId===n,console.log(`Job ${t} found in memory, belongs to user: ${i}`)}else console.log(`Job ${t} not found in memory`)}if(!o)return a.NextResponse.json({error:"Job not found"},{status:404});if(!i)return a.NextResponse.json({error:"You do not have permission to delete this job"},{status:403});if(console.log(`Deleting job ${t} for user ${n}`),await e(t))return a.NextResponse.json({success:!0,message:"Job deleted successfully",jobId:t});return console.error(`Failed to delete job ${t}`),a.NextResponse.json({error:"Failed to delete job completely",partialSuccess:!0},{status:500})}catch(e){return console.error(`Error in DELETE handler for job ${t}:`,e),a.NextResponse.json({error:"Server error deleting job",message:e.message||"Unknown error"},{status:500})}finally{r&&await r.$disconnect()}}catch(e){return console.error("Critical error in DELETE handler:",e),a.NextResponse.json({error:"Critical server error",message:e.message||"Unknown error"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/jobs/[id]/route",pathname:"/api/jobs/[id]",filename:"route",bundlePath:"app/api/jobs/[id]/route"},resolvedPagePath:"/Users/sankalp/fs2/email-scraper/src/app/api/jobs/[id]/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:g,workUnitAsyncStorage:h,serverHooks:j}=f;function m(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:h})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[978,116,190,839],()=>s(7354));module.exports=t})();